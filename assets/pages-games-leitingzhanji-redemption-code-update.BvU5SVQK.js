import{r as e,E as a,l,a7 as t,c as s,a as o,w as c,F as r,C as i,an as n,D as d,q as u,i as _,b as m,o as f,ad as p,g as x,h as y,e as v,M as b,t as g,f as w,n as h,a8 as k,m as T,I as C,aj as V,s as N}from"./index-D-gv67Fc.js";import{a as M,c as j}from"./config.CXGNUSHW.js";const $={__name:"update",setup($){uni.$sharePageTitle=`编辑兑换码-${M}`;const Y=a("dayjs");e(!1);const A=[new Array(3).fill(1).map(((e,a)=>({label:Y().year()+a-1+"年",value:Y().year()+a-1}))),new Array(12).fill(1).map(((e,a)=>({label:`${a+1}月`,value:a+1}))),new Array(31).fill(1).map(((e,a)=>({label:`${a+1}日`,value:a+1})))],O=e([0,0,0]),S=e({updateTime:"",rewardKeyMap:[],data:[]}),D=e(),J=e({index:0,code:"",reward:new Array(8).fill(""),expireTime:"",note:"",isNew:!1});l((()=>{i({title:"加载中"}),n({url:`https://runjs.work/transformer/project?id=${j}`,sslVerify:!1,success:e=>{var a,l;const t=null==(l=null==(a=e.data.data)?void 0:a.js)?void 0:l.source;if(e.data.data,t){const e=JSON.parse(t.replace(/\n/g," ").replace(/&quot;/g,'"')),{updateTime:a,rewardKeyMap:l,data:s}=e;S.value.updateTime=a,S.value.rewardKeyMap=l,S.value.data=s.map((e=>({code:e.c||e.code,reward:(e.r||e.reward).concat(new Array(8).fill("")).slice(0,8),expireTime:e.e||e.expireTime||e.invalidityTime,note:e.t||e.note||e.desc,isNew:e.n||e.isNew}))).reverse()}else u({title:"资源加载异常，请稍后重试",icon:"none"})},fail:()=>{u({title:"资源加载失败，请稍后重试",icon:"error"})},complete:()=>{d()}})})),t((()=>{S.value.data=[]}));const K=()=>{S.value.data.unshift({code:"",reward:new Array(8).fill(""),expireTime:Y().endOf("month").format("YYYY/MM/DD"),note:"",isNew:!0})},U=()=>{N({title:"提示",content:"确定删除吗？",success:e=>{e.confirm&&(S.value.data.splice(J.value.index,1),D.value.close())},fail:()=>{}})},q=()=>{const e=Y();O.value=[1,e.month(),e.date()-1]},E=e=>{const{value:a}=e.detail,l=Y(A.map(((e,l)=>e[a[l]].value)).join("/"));S.value.updateTime=l.format("YYYY/MM/DD")},P=(e,a)=>{void 0===a?J.value[e]="":J.value[e][a]=""},F=()=>{D.value.close()},I=()=>{const{index:e,...a}=J.value;a.code?(S.value.data[e]=JSON.parse(JSON.stringify(a)),D.value.close()):u({title:"请输入兑换码",icon:"none"})};return(e,a)=>{const l=m("my-page-header"),t=_,i=b,n=p,d=m("my-bottom-safety-space"),u=T,N=C,M=V,j=m("uni-popup");return f(),s(r,null,[o(l),o(t,{class:"pt_4"},{default:c((()=>[o(n,{class:"cursor_default",mode:"multiSelector","range-key":"label",value:O.value,range:A,onClick:q,onChange:E},{default:c((()=>[o(t,{class:"mx_4 mb_4 shadow radius bg-color"},{default:c((()=>[o(t,{class:"d_flex px_4 items_center"},{default:c((()=>[o(t,{class:"font_bold grow"},{default:c((()=>[v("时间")])),_:1}),S.value.updateTime?(f(),x(t,{key:0},{default:c((()=>[o(i,{class:"text-info text_base"},{default:c((()=>[v(g(S.value.updateTime),1)])),_:1})])),_:1})):y("",!0),o(t,{class:"my-icon my-icon-chevron-right text_xxl"})])),_:1})])),_:1})])),_:1},8,["value"]),o(t,{class:"mx_4 mb_4 shadow radius bg-color"},{default:c((()=>[(f(!0),s(r,null,w(S.value.data,((e,a)=>(f(),x(t,{key:a,class:h(["d_flex items_center text_base px_4 border_b p_relative",0===a?"radius_t":a===S.value.data.length-1?"radius_b":""]),"hover-class":"bg-hover",onClick:l=>((e,a)=>{J.value=JSON.parse(JSON.stringify({index:a,...e})),D.value.open()})(e,a)},{default:c((()=>[o(t,{class:"py_4"},{default:c((()=>[v(g(e.code),1),o(t,{class:"text-info text_xs"},{default:c((()=>[v(g(e.note),1)])),_:2},1024)])),_:2},1024),o(t,{class:"grow"}),o(t,{class:"text-info text_right"},{default:c((()=>[v(g(e.reward.map(((e,a)=>((e,a)=>a?`${a}${S.value.rewardKeyMap[e]||""}`:"")(a,e))).filter((e=>e)).join("，"))+" ",1),e.expireTime?(f(),x(t,{key:0,class:"text-info text_xs"},{default:c((()=>[v("失效时间："+g(e.expireTime),1)])),_:2},1024)):y("",!0)])),_:2},1024),e.expireTime&&k(Y)(`${e.expireTime} 23:59:59`)<k(Y)()?(f(),x(t,{key:0,class:"yang-badge ribbon info"},{default:c((()=>[o(t,{class:"content basic"},{default:c((()=>[v("已失效")])),_:1})])),_:1})):y("",!0),"永久"===e.expireTime?(f(),x(t,{key:1,class:"yang-badge ribbon"},{default:c((()=>[o(t,{class:"content basic"},{default:c((()=>[v("永久")])),_:1})])),_:1})):y("",!0),e.isNew?(f(),x(t,{key:2,class:"yang-badge ribbon"},{default:c((()=>[o(t,{class:"content basic"},{default:c((()=>[v("NEW")])),_:1})])),_:1})):y("",!0),o(t,{class:"my-icon my-icon-chevron-right text_xxl"})])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),o(t,{class:"yang-fab d_flex vertical items_end gap_2"},{default:c((()=>[o(t,{class:"yang-button primary circle m_0",onClick:K},{default:c((()=>[o(t,{class:"my-icon my-icon-plus text_xxl"})])),_:1})])),_:1}),o(d,{version:""}),o(j,{ref_key:"editPopup",ref:D,type:"bottom","safe-area":!1},{default:c((()=>[o(t,{class:"bg-color radius_t"},{default:c((()=>[o(t,{class:"d_flex px_4 py_3 items_center"},{default:c((()=>[o(t,{class:"font_bold"},{default:c((()=>[v("编辑兑换码")])),_:1}),o(t,{class:"grow"}),o(u,{class:"yang-button danger outline extra-small my-icon my-icon-delete","hover-class":"hover",onClick:U})])),_:1}),o(t,{class:"d_flex px_4 py_2 items_center border_t"},{default:c((()=>[o(t,{class:"title"},{default:c((()=>[v("兑换码")])),_:1}),o(N,{modelValue:J.value.code,"onUpdate:modelValue":a[0]||(a[0]=e=>J.value.code=e),class:"grow text_right",placeholder:"请输入兑换码"},null,8,["modelValue"]),o(t,{class:"my-icon my-icon-close-circle text-info ml_2",onClick:a[1]||(a[1]=e=>P("code"))})])),_:1}),(f(!0),s(r,null,w(S.value.rewardKeyMap,((e,a)=>(f(),x(t,{key:a,class:"d_flex px_4 py_2 items_center border_t"},{default:c((()=>[o(t,{class:"title"},{default:c((()=>[v(g(e),1)])),_:2},1024),o(N,{modelValue:J.value.reward[a],"onUpdate:modelValue":e=>J.value.reward[a]=e,class:"grow text_right",placeholder:`请输入${e}`},null,8,["modelValue","onUpdate:modelValue","placeholder"]),o(t,{class:"my-icon my-icon-close-circle text-info ml_2",onClick:e=>P("reward",a)},null,8,["onClick"])])),_:2},1024)))),128)),o(t,{class:"d_flex px_4 py_2 items_center border_t"},{default:c((()=>[o(t,{class:"title"},{default:c((()=>[v("是否新增")])),_:1}),o(t,{class:"grow"}),o(M,{checked:J.value.isNew,onChange:a[2]||(a[2]=e=>J.value.isNew=e.detail.value)},null,8,["checked"])])),_:1}),o(t,{class:"d_flex px_4 py_2 items_center border_t"},{default:c((()=>[o(t,{class:"title"},{default:c((()=>[v("失效时间")])),_:1}),o(N,{modelValue:J.value.expireTime,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value.expireTime=e),class:"grow text_right",placeholder:"请输入失效时间"},null,8,["modelValue"]),o(t,{class:"my-icon my-icon-close-circle text-info ml_2",onClick:a[4]||(a[4]=e=>P("expireTime"))})])),_:1}),o(t,{class:"d_flex px_4 py_2 items_center border_t"},{default:c((()=>[o(t,{class:"title"},{default:c((()=>[v("备注")])),_:1}),o(N,{modelValue:J.value.note,"onUpdate:modelValue":a[5]||(a[5]=e=>J.value.note=e),class:"grow text_right",placeholder:"请输入备注"},null,8,["modelValue"]),o(t,{class:"my-icon my-icon-close-circle text-info ml_2",onClick:a[6]||(a[6]=e=>P("note"))})])),_:1}),o(t,{class:"d_flex px_4 py_3 items_center border_t"},{default:c((()=>[o(u,{class:"yang-button outline block","hover-class":"hover",onClick:F},{default:c((()=>[v("取消")])),_:1}),o(u,{class:"yang-button primary block","hover-class":"hover",onClick:I},{default:c((()=>[v("保存")])),_:1})])),_:1}),o(t,{class:"h_safe"})])),_:1})])),_:1},512)],64)}}};export{$ as default};
