import{_ as a,r as e,z as l,v as s,A as t,B as o,C as i,q as c,c as n,a as r,g as u,h as d,w as m,F as _,i as y,D as v,b as f,o as p,e as b,m as k,f as h,n as x,t as g,E as w,d as C,G as P,j as Y,y as q,H as D,J as F,K as j,s as E,x as M}from"./index-CJZ7Tsaj.js";const T="app-video-analysis-watch-ad",V=a({__name:"video-watermarking",setup(a){uni.$sharePageTitle="短视频去水印";const V=v("dayjs"),I=!0,S="prod-9g9tuo2i7f723a6a",X="flask-ao4d",$=e(""),z=e({}),A=[{key:"video",name:"视频"},{key:"image",name:"图片"},{key:"title",name:"标题"}],B=e("video");l((a=>{var e;try{const e=s("app-video-analysis-history-list")||[];if(void 0!==a.index){const l=e[Number(a.index)];$.value=l.sharelink,J()}}catch(l){$.value=""}null==(e=uni.cloud)||e.init()})),t((()=>{}));const G=()=>{P({success:a=>{$.value=a.data},fail:()=>{}})},H=()=>{$.value=""},J=async()=>{if(o({title:"解析中……",mask:!0}),!$.value)return i(),void c({title:"请输入正确的链接。",icon:"none"});c({title:"本功能暂支支持《微信小程序》版本。",icon:"none"})},K=async()=>{const a=s(T);if(a&&a===V().format("YYYY-MM-DD"))return Promise.resolve(!0);if((await E({title:"提示",content:"观看一次广告，今日无限保存。",cancelText:"下次再说",confirmText:"观看广告"})).confirm){return await new Promise(((a,e)=>{a(!1)}))?(M(T,V().format("YYYY-MM-DD")),Promise.resolve(!0)):Promise.resolve(!1)}return Promise.resolve(!1)},N=async a=>{if(!(await K()))return;let e="";switch(a){case"video":e=z.value.video;break;case"image":e=z.value.cover;break;case"title":e=z.value.desc}q({data:e,fail:()=>{c({title:"复制失败，请检查设备微信权限。",icon:"none"})}})},O=async a=>{var e;if(await K())try{o({title:"下载中……",mask:!0});let l="";switch(a){case"video":l=z.value.video;break;case"image":l=z.value.cover}let s=null;if(!1===z.value.is_video_in_white&&I){const t=await wx.cloud.callContainer({path:"/downloadproxy/oss/",config:{env:S},header:{"X-WX-SERVICE":X,"content-type":"application/json"},method:"POST",data:{source:z.value.source,id:z.value.aweme_id,type:a,url:l}});if(200!==t.statusCode)throw new Error("资源代理失败");l=null==(e=t.data.data)?void 0:e.file_id,s=await wx.cloud.downloadFile({fileID:l})}else s=await D({url:l});200===s.statusCode?"video"===a?F({filePath:s.tempFilePath,success:a=>{i(),c({title:"视频保存成功",icon:"success"})},fail(a){i(),c({title:"视频保存失败",icon:"error"})}}):j({filePath:s.tempFilePath,success:a=>{i(),c({title:"图片保存成功",icon:"success"})},fail(a){i(),c({title:"图片保存失败",icon:"error"})}}):(i(),c({title:"一键下载失败，请复制链接至浏览器下载。",icon:"none"}))}catch(l){i(),c({title:"资源获取失败，请复制链接至浏览器下载。",icon:"error"})}},R=a=>{Y({url:`/pages/tools/video-watermarking/${a}`})};return(a,e)=>{const l=f("my-page-header"),s=f("my-ad-custom"),t=y,o=f("my-divider"),i=f("uni-easyinput"),c=k,v=w,P=C,Y=f("my-bottom-safety-space");return p(),n(_,null,[r(l),z.value.video&&!z.value.msg?(p(),u(t,{key:0},{default:m((()=>[r(s,{mp_weixin:"adunit-3eaf9cea980e809f",mp_qq:"c74f0b30cbf1b82004c9c785b7afc1c0",custom_class:"pt_4 mx_4"})])),_:1})):d("",!0),r(t,{class:"pt_4"},{default:m((()=>[r(t,{class:"notice d_flex items_center px_4 py_2 mx_4 mb_4 radius"},{default:m((()=>[r(t,{class:"my-icon my-icon-sound mr_2 text-primary"}),r(t,{class:""},{default:m((()=>[b("本功能暂支支持《微信小程序》版本。")])),_:1})])),_:1}),r(o,{content:"视频归平台及作者所有，本应用不存储任何视频及图片。"}),r(t,{class:"video-watermarking-textarea mx_4 mb_4"},{default:m((()=>[r(i,{type:"textarea",modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=a=>$.value=a),maxlength:"1000",placeholder:"请输入视频链接，目前已支持抖音和快手相关视频。"},null,8,["modelValue"])])),_:1}),r(t,{class:"d_flex mx_4 mb_4"},{default:m((()=>[r(c,{class:"yang-button primary outline block","hover-class":"hover",onClick:G},{default:m((()=>[r(t,{class:"my-icon my-icon-file-copy mr_2"}),r(t,{class:""},{default:m((()=>[b("一键粘贴")])),_:1})])),_:1}),r(c,{class:"yang-button danger outline block","hover-class":"hover",onClick:H},{default:m((()=>[r(t,{class:"my-icon my-icon-delete mr_2"}),r(t,{class:""},{default:m((()=>[b("清空")])),_:1})])),_:1})])),_:1}),r(t,{class:"mx_4 mb_4"},{default:m((()=>[r(c,{class:"yang-button primary block","hover-class":"hover",onClick:J},{default:m((()=>[r(t,{class:"my-icon my-icon-rocket mr_2"}),r(t,{class:""},{default:m((()=>[b("立即去水印")])),_:1})])),_:1})])),_:1}),r(t,{class:"d_flex mx_4 mb_4"},{default:m((()=>[r(c,{class:"yang-button primary outline small block","hover-class":"hover",onClick:e[1]||(e[1]=a=>R("history"))},{default:m((()=>[r(t,{class:"my-icon my-icon-list mr_1"}),r(t,{class:""},{default:m((()=>[b("解析记录")])),_:1})])),_:1}),r(c,{class:"yang-button primary outline small block","hover-class":"hover",onClick:e[2]||(e[2]=a=>R("questions"))},{default:m((()=>[r(t,{class:"my-icon my-icon-list mr_1"}),r(t,{class:""},{default:m((()=>[b("常见问题")])),_:1})])),_:1}),r(c,{class:"yang-button primary outline small block","hover-class":"hover",onClick:e[3]||(e[3]=a=>R("tutorial"))},{default:m((()=>[r(t,{class:"my-icon my-icon-list mr_1"}),r(t,{class:""},{default:m((()=>[b("使用教程")])),_:1})])),_:1})])),_:1}),z.value.video?d("",!0):(p(),u(o,{key:0,content:"若首次解析失败请等待十秒左右重试。"})),z.value.video&&!z.value.msg?(p(),u(t,{key:1,class:"mx_4 pt_2 shadow radius bg-color mb_4"},{default:m((()=>[r(t,{class:"yang-nav-tabs evenly border_b"},{default:m((()=>[(p(),n(_,null,h(A,((a,e)=>r(t,{key:e,class:x(["yang-tabs__item py_2",{active:a.key==B.value}]),onClick:e=>{return l=a.key,void(B.value=l);var l}},{default:m((()=>[b(g(a.name),1)])),_:2},1032,["class","onClick"]))),64))])),_:1}),"video"===B.value?(p(),u(t,{key:0,class:"body py_4"},{default:m((()=>[r(t,{class:"mb_4"},{default:m((()=>[r(t,{class:"d_flex px_4"},{default:m((()=>[r(v,{src:z.value.video,poster:z.value.cover,class:"media grow"},null,8,["src","poster"])])),_:1})])),_:1}),r(t,{class:"d_flex items_center content_between px_4"},{default:m((()=>[r(c,{class:"yang-button primary outline m_0","hover-class":"hover",onClick:e[4]||(e[4]=a=>N("video"))},{default:m((()=>[r(t,{class:"my-icon my-icon-file-copy mr_2"}),r(t,{class:""},{default:m((()=>[b("复制链接")])),_:1})])),_:1}),r(c,{class:"yang-button primary m_0","hover-class":"hover",onClick:e[5]||(e[5]=a=>O("video"))},{default:m((()=>[z.value.is_video_in_white?(p(),u(t,{key:0,class:"my-icon my-icon-cloud-download mr_2"})):(p(),u(t,{key:1,class:"my-icon my-icon-file-download mr_2"})),r(t,{class:""},{default:m((()=>[b("下载视频")])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0),"image"===B.value?(p(),u(t,{key:1,class:"body py_4"},{default:m((()=>[r(t,{class:"mb_4"},{default:m((()=>[r(t,{class:"d_flex px_4"},{default:m((()=>[r(P,{src:z.value.cover,mode:"aspectFit",class:"media grow"},null,8,["src"])])),_:1})])),_:1}),r(t,{class:"d_flex content_between px_4"},{default:m((()=>[r(c,{class:"yang-button primary outline m_0","hover-class":"hover",onClick:e[6]||(e[6]=a=>N("image"))},{default:m((()=>[r(t,{class:"my-icon my-icon-file-copy mr_2"}),r(t,{class:""},{default:m((()=>[b("复制链接")])),_:1})])),_:1}),r(c,{class:"yang-button primary m_0","hover-class":"hover",onClick:e[7]||(e[7]=a=>O("image"))},{default:m((()=>[z.value.is_video_in_white?(p(),u(t,{key:0,class:"my-icon my-icon-cloud-download mr_2"})):(p(),u(t,{key:1,class:"my-icon my-icon-file-download mr_2"})),r(t,{class:""},{default:m((()=>[b("下载图片")])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0),"title"===B.value?(p(),u(t,{key:2,class:"body py_4"},{default:m((()=>[r(t,{class:"video-watermarking-textarea px_4 mb_4"},{default:m((()=>[r(i,{type:"textarea",value:z.value.desc,maxlength:"1000"},null,8,["value"])])),_:1}),r(t,{class:"d_flex px_4"},{default:m((()=>[r(c,{class:"yang-button primary outline m_0",onClick:e[8]||(e[8]=a=>N("title"))},{default:m((()=>[r(t,{class:"my-icon my-icon-file-copy mr_2"}),r(t,{class:""},{default:m((()=>[b("复制标题")])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0)])),_:1})):d("",!0),r(s,{mp_weixin:"adunit-4487e043d6b98f83",mp_qq:"54ea1b2e68ecb1caa66494c8dc68d3b7"}),r(Y,{version:""})])),_:1})],64)}}},[["__scopeId","data-v-1f35aa5e"]]);export{V as default};
