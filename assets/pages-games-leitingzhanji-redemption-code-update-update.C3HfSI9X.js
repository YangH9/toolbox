import{_ as e,S as a,z as l,r as t,a as s,e as o,b as r,w as c,R as d,c as i,j as n,F as u,U as _,V as f,s as p,W as m,i as v,o as y,d as b,t as g,f as x,p as h,Q as w,T as k,u as $,I as j,a5 as N,h as C}from"./index-auO82zA0.js";import{a as T,c as S}from"./config.DmCWn7As.js";import{u as V}from"./uni-popup.CGQmyLcT.js";const O=e({__name:"update",setup(e){var O;uni.$sharePageTitle=`编辑兑换码-${T}`;const J=a("dayjs");let M={};const K=null==(O=l)?void 0:O().enableDebug,Y=[Array.from({length:3},((e,a)=>({label:J().year()+a-1+"年",value:J().year()+a-1}))),Array.from({length:12},((e,a)=>({label:`${a+1}月`,value:a+1}))),Array.from({length:31},((e,a)=>({label:`${a+1}日`,value:a+1})))],U=t([0,0,0]),A=t({updateTime:"",rewardKeyMap:[],data:[]}),D=t(),P=t({index:0,code:"",reward:["","","","","",""],invalidity:!1,forever:!1,isNew:!1});_({title:"加载中"}),f({url:`https://runjs.work/transformer/project?id=${S}`,sslVerify:!1,success:e=>{var a,l;const t=null==(l=null==(a=e.data.data)?void 0:a.js)?void 0:l.source;if(M=e.data.data,t){const e=JSON.parse(t.replace(/\n/g," ").replace(/&quot;/g,'"')),{updateTime:a,rewardKeyMap:l,data:s}=e;A.value.updateTime=a,A.value.rewardKeyMap=l,A.value.data=s.reverse()}else p({title:"资源加载异常",icon:"none"})},fail:()=>{p({title:"资源加载失败",icon:"error"})},complete:()=>{m()}});const W=()=>{A.value.data.unshift({code:"",reward:["","","","","",""],invalidity:!1,isNew:!0})},I=()=>{h({title:"提示",content:"确定删除吗？",success:e=>{e.confirm&&(A.value.data.splice(P.value.index,1),D.value.close())}})},q=()=>{const e=J();U.value=[1,e.month(),e.date()-1]},z=e=>{const{value:a}=e.detail,l=J(Y.map(((e,l)=>e[a[l]].value)).join("/"));A.value.updateTime=l.format("YYYY/MM/DD")},E=e=>{const{index:a}=e.currentTarget.dataset,l=JSON.parse(JSON.stringify(A.value.data[a]));P.value={index:a,...l},D.value.open()},F=(e,a)=>{void 0===a?P.value[e]="":P.value[e][a]=""},Q=()=>{D.value.close()},R=()=>{const{index:e,...a}=P.value;a.code?(A.value.data[e]=JSON.parse(JSON.stringify(a)),D.value.close()):p({title:"请输入兑换码",icon:"none"})},B=()=>{_({title:"保存中……"});const{updateTime:e,data:a}=JSON.parse(JSON.stringify(A.value)),l=M.js.source.replace(/"updateTime": "[0-9/]{10}"/,`"updateTime": "${e}"`).replace(/"data": \[[\s\S.]*  \]/,`"data": [${a.reverse().map((e=>`\n    { "code": "${e.code}", "reward": [${e.reward.map((e=>`"${e||""}"`)).join(", ")}]${e.isNew?', "isNew": true':""}${e.invalidity?', "invalidity": true':""}${e.forever?', "forever": true':""} }`)).join(",")}\n  ]`);M.js.source=l,f({url:"https://runjs.work/transformer/store?isTemp=0",sslVerify:!1,data:{data:M},header:{cookie:uni.$runjsCookie},method:"POST",success:e=>{0===e.data.code?p({title:"保存成功"}):p({title:`保存失败-${e.data.message}`,icon:"none"})},fail:()=>{p({title:"保存失败，网络异常",icon:"error"})},complete:()=>{m()}})};return(e,a)=>{const l=v,t=w,_=k,f=s("my-bottom-safety-space"),p=$,m=j,h=N;return y(),o(u,null,[r(l,{class:"pt_4"},{default:c((()=>[r(_,{class:"cursor_default",mode:"multiSelector","range-key":"label",value:U.value,range:Y,onClick:q,onChange:z},{default:c((()=>[r(l,{class:"mx_4 mb_4 shadow radius bg-color"},{default:c((()=>[r(l,{class:"d_flex px_4 items_center"},{default:c((()=>[r(l,{class:"font_bold grow"},{default:c((()=>[b("时间")])),_:1}),A.value.updateTime?(y(),i(l,{key:0},{default:c((()=>[r(t,{class:"text-info text_base"},{default:c((()=>[b(g(A.value.updateTime),1)])),_:1})])),_:1})):n("",!0),r(l,{class:"my-icon my-icon-chevron-right text_xxl"})])),_:1})])),_:1})])),_:1},8,["value"]),r(l,{class:"mx_4 mb_4 shadow radius bg-color"},{default:c((()=>[(y(!0),o(u,null,x(A.value.data,((e,a)=>(y(),i(l,{key:a,class:C(["d_flex items_center text_base px_4 p_relative",0===a?"radius_t border_b":a===A.value.data.length?"radius_b":"border_b"]),"hover-class":"bg-hover","data-index":a,onClick:E},{default:c((()=>[r(l,{class:"py_4"},{default:c((()=>[b(g(e.code),1)])),_:2},1024),r(l,{class:"grow"}),r(l,{class:"text-info text_right"},{default:c((()=>[b(g(e.reward.map(((e,a)=>((e,a)=>a?`${a}${A.value.rewardKeyMap[e]||""}`:"")(a,e))).filter((e=>e)).join("，")),1)])),_:2},1024),e.invalidity?(y(),i(l,{key:0,class:"yang-badge ribbon info"},{default:c((()=>[r(l,{class:"content basic"},{default:c((()=>[b("已失效")])),_:1})])),_:1})):n("",!0),e.forever?(y(),i(l,{key:1,class:"yang-badge ribbon"},{default:c((()=>[r(l,{class:"content basic"},{default:c((()=>[b("永久")])),_:1})])),_:1})):n("",!0),e.isNew?(y(),i(l,{key:2,class:"yang-badge ribbon"},{default:c((()=>[r(l,{class:"content basic"},{default:c((()=>[b("NEW")])),_:1})])),_:1})):n("",!0),r(l,{class:"my-icon my-icon-chevron-right text_xxl"})])),_:2},1032,["class","data-index"])))),128))])),_:1})])),_:1}),d(K)?(y(),i(l,{key:0,class:"save yang-fab yang-button primary circle",onClick:B},{default:c((()=>[r(l,{class:"my-icon my-icon-save text_xxl"})])),_:1})):n("",!0),r(l,{class:"plus yang-fab yang-button primary circle",onClick:W},{default:c((()=>[r(l,{class:"my-icon my-icon-plus text_xxl"})])),_:1}),r(f,{version:""}),r(V,{ref_key:"editPopup",ref:D,type:"bottom","safe-area":!1},{default:c((()=>[r(l,{class:"edit-popup bg-color radius_t"},{default:c((()=>[r(l,{class:"d_flex px_4 py_3 items_center"},{default:c((()=>[r(l,{class:"font_bold"},{default:c((()=>[b("编辑兑换码")])),_:1}),r(l,{class:"grow"}),r(p,{class:"yang-button danger outline extra-small my-icon my-icon-delete","hover-class":"hover",onClick:I})])),_:1}),r(l,{class:"d_flex px_4 py_3 items_center border_t"},{default:c((()=>[r(l,{class:"title"},{default:c((()=>[b("兑换码")])),_:1}),r(m,{modelValue:P.value.code,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value.code=e),class:"grow text_right",placeholder:"请输入兑换码"},null,8,["modelValue"]),r(l,{class:"my-icon my-icon-close-circle text-info ml_2",onClick:a[1]||(a[1]=e=>F("code"))})])),_:1}),(y(!0),o(u,null,x(A.value.rewardKeyMap,((e,a)=>(y(),i(l,{key:a,class:"d_flex px_4 py_3 items_center border_t"},{default:c((()=>[r(l,{class:"title"},{default:c((()=>[b(g(e),1)])),_:2},1024),r(m,{modelValue:P.value.reward[a],"onUpdate:modelValue":e=>P.value.reward[a]=e,class:"grow text_right",placeholder:`请输入${e}`},null,8,["modelValue","onUpdate:modelValue","placeholder"]),r(l,{class:"my-icon my-icon-close-circle text-info ml_2",onClick:e=>F("reward",a)},null,8,["onClick"])])),_:2},1024)))),128)),r(l,{class:"d_flex px_4 py_3 items_center border_t"},{default:c((()=>[r(l,{class:"title"},{default:c((()=>[b("是否新增")])),_:1}),r(l,{class:"grow"}),r(h,{checked:P.value.isNew,onChange:a[2]||(a[2]=e=>P.value.isNew=e.detail.value)},null,8,["checked"])])),_:1}),r(l,{class:"d_flex px_4 py_3 items_center border_t"},{default:c((()=>[r(l,{class:"title"},{default:c((()=>[b("是否失效")])),_:1}),r(l,{class:"grow"}),r(h,{checked:P.value.invalidity,onChange:a[3]||(a[3]=e=>P.value.invalidity=e.detail.value)},null,8,["checked"])])),_:1}),r(l,{class:"d_flex px_4 py_3 items_center border_t"},{default:c((()=>[r(p,{class:"yang-button outline block","hover-class":"hover",onClick:Q},{default:c((()=>[b("取消")])),_:1}),r(p,{class:"yang-button primary block","hover-class":"hover",onClick:R},{default:c((()=>[b("保存")])),_:1})])),_:1}),r(l,{class:"h_safe"})])),_:1})])),_:1},512)],64)}}},[["__scopeId","data-v-e520bd7c"]]);export{O as default};
