import{_ as e,r as a,J as l,c as t,a as s,w as o,F as r,G as c,am as d,H as i,s as n,i as u,B as _,b as m,C as f,o as p,a6 as x,g as v,h as y,e as g,A as b,t as h,f as k,n as w,u as C,p as T,I as V,af as N,v as j}from"./index-_z_cEels.js";import{_ as M}from"./uni-popup.C2S6GoET.js";import{a as $,c as Y}from"./config.Dny4K3GL.js";const J=e({__name:"update",setup(e){uni.$sharePageTitle=`编辑兑换码-${$}`;const J=l("dayjs"),O=a(!1),S=[Array.from({length:3},((e,a)=>({label:J().year()+a-1+"年",value:J().year()+a-1}))),Array.from({length:12},((e,a)=>({label:`${a+1}月`,value:a+1}))),Array.from({length:31},((e,a)=>({label:`${a+1}日`,value:a+1})))],A=a([0,0,0]),K=a({updateTime:"",rewardKeyMap:[],data:[]}),U=a(),D=a({index:0,code:"",reward:["","","","","","","",""],expireTime:"",note:"",isNew:!1});c({title:"加载中"}),d({url:`https://runjs.work/transformer/project?id=${Y}`,sslVerify:!1,success:e=>{var a,l;const t=null==(l=null==(a=e.data.data)?void 0:a.js)?void 0:l.source;if(e.data.data,t){const e=JSON.parse(t.replace(/\n/g," ").replace(/&quot;/g,'"')),{updateTime:a,rewardKeyMap:l,data:s}=e;K.value.updateTime=a,K.value.rewardKeyMap=l,K.value.data=s.map((e=>({code:e.c||e.code,reward:e.r||e.reward,expireTime:e.e||e.expireTime||e.invalidityTime,note:e.t||e.note||e.desc,isNew:e.n||e.isNew}))).reverse()}else n({title:"资源加载异常，请稍后重试",icon:"none"})},fail:()=>{n({title:"资源加载失败，请稍后重试",icon:"error"})},complete:()=>{i()}});const E=()=>{K.value.data.unshift({code:"",reward:["","","","","","","",""],expireTime:J().endOf("month").format("YYYY/MM/DD"),note:"",isNew:!0})},I=()=>{j({title:"提示",content:"确定删除吗？",success:e=>{e.confirm&&(K.value.data.splice(D.value.index,1),U.value.close())},fail:e=>{}})},P=()=>{const e=J();A.value=[1,e.month(),e.date()-1]},R=e=>{const{value:a}=e.detail,l=J(S.map(((e,l)=>e[a[l]].value)).join("/"));K.value.updateTime=l.format("YYYY/MM/DD")},q=e=>{const{index:a}=e.currentTarget.dataset,l=JSON.parse(JSON.stringify(K.value.data[a]));D.value={index:a,...l},U.value.open()},B=(e,a)=>{void 0===a?D.value[e]="":D.value[e][a]=""},F=()=>{U.value.close()},G=()=>{const{index:e,...a}=D.value;a.code?(K.value.data[e]=JSON.parse(JSON.stringify(a)),U.value.close()):n({title:"请输入兑换码",icon:"none"})};return(e,a)=>{const l=m("my-page-header"),c=u,d=b,i=x,n=m("my-bottom-safety-space"),j=T,$=V,Y=N,H=_(f("uni-popup"),M);return p(),t(r,null,[s(l),s(c,{class:"pt_4"},{default:o((()=>[s(i,{class:"cursor_default",mode:"multiSelector","range-key":"label",value:A.value,range:S,onClick:P,onChange:R},{default:o((()=>[s(c,{class:"mx_4 mb_4 shadow radius bg-color"},{default:o((()=>[s(c,{class:"d_flex px_4 items_center"},{default:o((()=>[s(c,{class:"font_bold grow"},{default:o((()=>[g("时间")])),_:1}),K.value.updateTime?(p(),v(c,{key:0},{default:o((()=>[s(d,{class:"text-info text_base"},{default:o((()=>[g(h(K.value.updateTime),1)])),_:1})])),_:1})):y("",!0),s(c,{class:"my-icon-chevron-right text_xxl"})])),_:1})])),_:1})])),_:1},8,["value"]),s(c,{class:"mx_4 mb_4 shadow radius bg-color"},{default:o((()=>[(p(!0),t(r,null,k(K.value.data,((e,a)=>(p(),v(c,{key:a,class:w(["d_flex items_center text_base px_4 border_b p_relative",0===a?"radius_t":a===K.value.data.length?"radius_b":""]),"hover-class":"bg-hover","data-index":a,onClick:q},{default:o((()=>[s(c,{class:"py_4"},{default:o((()=>[g(h(e.code),1),s(c,{class:"text-info text_xs"},{default:o((()=>[g(h(e.note),1)])),_:2},1024)])),_:2},1024),s(c,{class:"grow"}),s(c,{class:"text-info text_right"},{default:o((()=>[g(h(e.reward.map(((e,a)=>((e,a)=>a?`${a}${K.value.rewardKeyMap[e]||""}`:"")(a,e))).filter((e=>e)).join("，"))+" ",1),e.expireTime?(p(),v(c,{key:0,class:"text-info text_xs"},{default:o((()=>[g("失效时间："+h(e.expireTime),1)])),_:2},1024)):y("",!0)])),_:2},1024),e.expireTime&&C(J)(`${e.expireTime} 23:59:59`)<C(J)()?(p(),v(c,{key:0,class:"yang-badge ribbon info"},{default:o((()=>[s(c,{class:"content basic"},{default:o((()=>[g("已失效")])),_:1})])),_:1})):y("",!0),"永久"===e.expireTime?(p(),v(c,{key:1,class:"yang-badge ribbon"},{default:o((()=>[s(c,{class:"content basic"},{default:o((()=>[g("永久")])),_:1})])),_:1})):y("",!0),e.isNew?(p(),v(c,{key:2,class:"yang-badge ribbon"},{default:o((()=>[s(c,{class:"content basic"},{default:o((()=>[g("NEW")])),_:1})])),_:1})):y("",!0),s(c,{class:"my-icon-chevron-right text_xxl"})])),_:2},1032,["class","data-index"])))),128))])),_:1})])),_:1}),s(c,{class:"yang-fab d_flex vertical items_end gap_2"},{default:o((()=>[O.value?y("",!0):(p(),v(c,{key:0,class:"yang-button fab_text primary round m_0",onClick:e.sendCodeExpireRemind},{default:o((()=>[g(" 兑换码失效通知 ")])),_:1},8,["onClick"])),O.value?y("",!0):(p(),v(c,{key:1,class:"yang-button fab_text primary round m_0",onClick:e.sendCodeAddRemind},{default:o((()=>[g(" 兑换码新增通知 ")])),_:1},8,["onClick"])),O.value?y("",!0):(p(),v(c,{key:2,class:"yang-button primary circle m_0",onClick:e.saveCode},{default:o((()=>[s(c,{class:"my-icon-save text_xxl"})])),_:1},8,["onClick"])),s(c,{class:"yang-button primary circle m_0",onClick:E},{default:o((()=>[s(c,{class:"my-icon-plus text_xxl"})])),_:1})])),_:1}),s(n,{version:""}),s(H,{ref_key:"editPopup",ref:U,type:"bottom","safe-area":!1},{default:o((()=>[s(c,{class:"bg-color radius_t"},{default:o((()=>[s(c,{class:"d_flex px_4 py_3 items_center"},{default:o((()=>[s(c,{class:"font_bold"},{default:o((()=>[g("编辑兑换码")])),_:1}),s(c,{class:"grow"}),s(j,{class:"yang-button danger outline extra-small my-icon-delete","hover-class":"hover",onClick:I})])),_:1}),s(c,{class:"d_flex px_4 py_2 items_center border_t"},{default:o((()=>[s(c,{class:"title"},{default:o((()=>[g("兑换码")])),_:1}),s($,{modelValue:D.value.code,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value.code=e),class:"grow text_right",placeholder:"请输入兑换码"},null,8,["modelValue"]),s(c,{class:"my-icon-close-circle text-info ml_2",onClick:a[1]||(a[1]=e=>B("code"))})])),_:1}),(p(!0),t(r,null,k(K.value.rewardKeyMap,((e,a)=>(p(),v(c,{key:a,class:"d_flex px_4 py_2 items_center border_t"},{default:o((()=>[s(c,{class:"title"},{default:o((()=>[g(h(e),1)])),_:2},1024),s($,{modelValue:D.value.reward[a],"onUpdate:modelValue":e=>D.value.reward[a]=e,class:"grow text_right",placeholder:`请输入${e}`},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(c,{class:"my-icon-close-circle text-info ml_2",onClick:e=>B("reward",a)},null,8,["onClick"])])),_:2},1024)))),128)),s(c,{class:"d_flex px_4 py_2 items_center border_t"},{default:o((()=>[s(c,{class:"title"},{default:o((()=>[g("是否新增")])),_:1}),s(c,{class:"grow"}),s(Y,{checked:D.value.isNew,onChange:a[2]||(a[2]=e=>D.value.isNew=e.detail.value)},null,8,["checked"])])),_:1}),s(c,{class:"d_flex px_4 py_2 items_center border_t"},{default:o((()=>[s(c,{class:"title"},{default:o((()=>[g("失效时间")])),_:1}),s($,{modelValue:D.value.expireTime,"onUpdate:modelValue":a[3]||(a[3]=e=>D.value.expireTime=e),class:"grow text_right",placeholder:"请输入失效时间"},null,8,["modelValue"]),s(c,{class:"my-icon-close-circle text-info ml_2",onClick:a[4]||(a[4]=e=>B("expireTime"))})])),_:1}),s(c,{class:"d_flex px_4 py_2 items_center border_t"},{default:o((()=>[s(c,{class:"title"},{default:o((()=>[g("备注")])),_:1}),s($,{modelValue:D.value.note,"onUpdate:modelValue":a[5]||(a[5]=e=>D.value.note=e),class:"grow text_right",placeholder:"请输入备注"},null,8,["modelValue"]),s(c,{class:"my-icon-close-circle text-info ml_2",onClick:a[6]||(a[6]=e=>B("note"))})])),_:1}),s(c,{class:"d_flex px_4 py_3 items_center border_t"},{default:o((()=>[s(j,{class:"yang-button outline block","hover-class":"hover",onClick:F},{default:o((()=>[g("取消")])),_:1}),s(j,{class:"yang-button primary block","hover-class":"hover",onClick:G},{default:o((()=>[g("保存")])),_:1})])),_:1}),s(c,{class:"h_safe"})])),_:1})])),_:1},512)],64)}}},[["__scopeId","data-v-e9f91a7f"]]);export{J as default};
